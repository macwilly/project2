<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Medical Services Search</title>
<script src="http://code.jquery.com/jquery-latest.js" type="text/javascript"></script>
<script src="media/jquery-ui-1.11.1/jquery-ui.min.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="media/jquery-ui-1.11.1/jquery-ui.min.css">
<script type="text/javascript">
        //////////////////////////--making the dialog box--/////////////////////////////////    
 $(function() {
    $( "#dialogBox" ).dialog();
  });

    
	function getTabs(orgId){
		//http://simon.ist.rit.edu:8080/Services/resources/ESD/Application/Tabs?orgId=1002
		$.ajax({
			type:'get',
			url:'media/proxy.php',
			dataType:'xml', 
			data:{path:'/Application/Tabs?orgId='+orgId},
			success: function(data){
                //making a outter box 
                var box = '<div id="dialogBox">';
                
                //if there are errors do not do anything 
                if($(data).find('error').length!=0){
                    
                    
                }else{
                    //this will be that div that has that main tabs(following the pattern from jQuery UI)
                    var tabs= '<div id="tabs" class="ui-tabs"><ul class="ui-tabs-nav">';
                    
                    var innerDiv = '';
                    // get the information for that tabs 
                    $('Tab',data).each(function(){
						//build the links/tabs
						tabs+='<li><a href="#'+$(this).text()+'">'+$(this).text()+'</a></li>';
						//build the divs by calling the tab's getInfo functions
						innerDiv+="<div id='"+$(this).text()+"'>"+window['get'+$(this).text()](orgId)+"</div>";
					});
                    
                    box +=tabs + '</ul>' + innerDiv + '</div></div>';
                    $('#dump').html(box);
                   // $("#dialogBox").dialog( "open" );

                }//end of else 
                
				//<data><row><Tab>General</Tab></row><row><Tab>Locations</Tab></row><row><Tab>Treatment</Tab></row><row><Tab>Training</Tab></row><row><Tab>Equipment</Tab></row><row><Tab>People</Tab></row></data>
				//build a select menu (you can't do this for your project, you must have tabs - but this will get you most of the way)
				//var x='<select onchange="window[\'get\'+$(this).val()]('+orgId+')">';
				//$('Tab',data).each(function(){
					//output the options
				//	x+='<option value="'+$(this).text()+'">'+$(this).text()+'</option>';
				//});
				//$('#dump').html(x+'</select>');
				//getGeneral(orgId);
			},
			error:err
		});
	}//end of getTabs

	
	function err(event){
		console.log(event);
	}
	
		
	function getGeneral(id){
		$.ajax({
			type:'get',
			url:'media/proxy.php',
			dataType:'xml', 
			data:{path:'/'+id+'/General'},
			success: function(data){
				var x='<tr><td>Name:</td><td>'+$(data).find('name').text()+'</td></tr>';
				x+='<tr><td>Description</td><td>'+$(data).find('description').text()+'</td></tr>';
				x+='<tr><td>Email:</td><td>'+$(data).find('email').text()+'</td></tr>';
				x+='<tr><td>Website:</td><td>'+$(data).find('website').text()+'</td></tr>';
				x+='<tr><td>Number of Members:</td><td>'+$(data).find('nummembers').text()+'</td></tr>';
				x+='<tr><td>Number of Calls:</td><td>'+$(data).find('numcalls').text()+'</td></tr>';
				$('#output').html(x);
                //return x;
                //$('#'+(this).text()).html(x);
                
			},
			error:err
		});
	}
	
	function getLocations(id){
		alert('get locations for '+id);
        //getTabs(id);
	}//end getlocations
    
    function getTreatment(id){
        alert('get treatment for ' + id);
    } //end getTreatment
    
    function getTraining(id){
        alert('get training information for'+id);
    }//end getTraining
	
	function getFacilities(id){
		alert('get fac for '+id);
	}//end getFacilities
        
    function getPhysicians(id){
        alert('get physicians for '+id);
    }//end of getPhysicians 
	
	function getPeople(id){
		alert('get peps for '+id);
	}//end getPeople
    
    function getEquipment(id){
        alert('get equip'+id);
    }//end getEquipment
    
    


///-------------------------------------------------

//onload go get the orgTypes and the cities...
$(document).ready(function(){
	getCities( $('#state').val() );
	getOrgTypes();
});


function getOrgTypes(){
	//hit the server to populate the organizational types.
	$.ajax({
		type:'get',
		async:true,
		cache:false,
		url:'media/proxy.php',
		data:{path:'/OrgTypes'},
		dataType:'xml',
		success:function(data,status){
			var x='<option value="">--Pick an organization type--</option>';
			$('type',data).each(
				function(){
					x+='<option value="'+$(this).text()+'">'+$(this).text()+'</option>';
				}
			);
			//put it on the select
			$('#orgType').html(x);
		},
		error:err
	});
}
	
function getCities(state){
	$.ajax({
		type:'get',
		async:true,
		cache:false,
		url:'media/proxy.php',
		data:{path:'/Cities?state='+state},
		dataType:'xml',
		success:function(data,status){
			//what if there are no cities?
			if($(data).find('row').length==0){
				var x='<span style="color:red">there are no cities here</span>';
			}else{
				var x='<select name="town"><option value="">--Select a city--</option>';
				$('row',data).each(function(){
					x+='<option value="'+$(this).text()+'">'+$(this).text()+'</option>';
				});
				x+='</select>';
			}	
			$('#orgCitySearch').html(x);
		},
		error:err
	});
}


function checkSearch(){
	//go get the data!
	//console.log($('form:first').serialize());
	$.ajax({	
		type:'get',
		async:true,
		cache:false,
		url:'media/proxy.php',
		data:{path:'/Organizations?'+$('form:first').serialize()},
		dataType:'xml',
		success:function(data,status){
			/*<row>
<OrganizationID>1877</OrganizationID>
<type>Fire Department</type>
<Name>3-G (Glenfield) Fire Department</Name>
<Email>amandajean57@yahoo.com</Email>
<city>Glenfield</city>
<zip>13345</zip>
<CountyName>Lewis</CountyName>
<State>NY</State>
</row>*/
			//when we get this back, we will get 2 different data sets
			//	one for physician (your problem)
			//	one for everything else
			if($(data).find('row').length==0){
				//give feedback that there are no orgs for that!
                var noData= '<p>There was no data found for this. Please make another selection</p>';
                $('#tableOutput').html(noData);
                
			}else{
				//give feedback on how many orgs were found
				//put out table headers for labels of columns!
				var x='<table border="1">';
				$('row',data).each(function(){
					x+='<tr>';
					x+='<td>'+$(this).find('type').text()+'</td>';
					x+='<td><span id="click" style="color:blue;cursor:pointer;" onclick="getTabs(' +$(this).find('OrganizationID').text()+ ')">'+$(this).find('Name').text()+'</span></td>';
					x+='<td>'+$(this).find('Email').text()+'</td>';
					x+='<td>'+$(this).find('city').text()+'</td>';
					x+='<td>'+$(this).find('State').text()+'</td>';
					x+='<td>'+$(this).find('CountyName').text()+'</td>';
					x+='<td>'+$(this).find('zip').text()+'</td></tr>';
				});
				$('#tableOutput').html(x+'</table>');
			}
		},
		error:err
	});
}


</script>
</head>
<body><!--
  <h2>ESD Example</h2>Input org Id:
  <form>
    <input type="text" id="orgId"/><input type="button" value="find data" onclick="getTabs($('#orgId').val())"/>
    
  </form>
  <hr>-->
  <!------------------ Will Use soon! --------------->
  <form style="">
    <fieldset>
      <legend><a href="BackendDocumentation.html"> Search Criteria</a></legend>
      <p>Organization Type <select id="orgType" name="type" onchange=""></select></p>
      <p><span id="orgLabel">Organization Name</span> <input id="orgName" name="name" type="text"> <em style="color: rgb(104, 129, 162);">*can be partial - "vol" for "Volunteer"</em></p>
      <p>State <select name="state" id="state" onchange="getCities(this.value)">
        <option value="">
          All States
        </option>
        <option value="AK">AK</option>
        <option value="AL">AL</option>
        <option value="AR">AR</option>
        <option value="AZ">AZ</option>
        <option value="CA">CA</option>
        <option value="CO">CO</option>
        <option value="CT">CT</option>
        <option value="DC">DC</option>
        <option value="DE">DE</option>
        <option value="FL">FL</option>
        <option value="GA">GA</option>
        <option value="HI">HI</option>
        <option value="IA">IA</option>
        <option value="ID">ID</option>
        <option value="IL">IL</option>
        <option value="IN">IN</option>
        <option value="KS">KS</option>
        <option value="KY">KY</option>
        <option value="LA">LA</option>
        <option value="MA">MA</option>
        <option value="MD">MD</option>
        <option value="ME">ME</option>
        <option value="MI">MI</option>
        <option value="MN">MN</option>
        <option value="MO">MO</option>
        <option value="MS">MS</option>
        <option value="MT">MT</option>
        <option value="NC">NC</option>
        <option value="ND">ND</option>
        <option value="NE">NE</option>
        <option value="NH">NH</option>
        <option value="NJ">NJ</option>
        <option value="NM">NM</option>
        <option value="NV">NV</option>
        <option value="NY" selected="selected">NY</option>
        <option value="OH">OH</option>
        <option value="OK">OK</option>
        <option value="OR">OR</option>
        <option value="PA">PA</option>
        <option value="RI">RI</option>
        <option value="SC">SC</option>
        <option value="SD">SD</option>
        <option value="TN">TN</option>
        <option value="TX">TX</option>
        <option value="UT">UT</option>
        <option value="VA">VA</option>
        <option value="VT">VT</option>
        <option value="WA">WA</option>
        <option value="WI">WI</option>
        <option value="WV">WV</option>
        <option value="WY">WY</option>
      </select> <span id="orgCitySearch"></span></p>
      <p>County <input id="county" name="county" type="text"></p>
      <p>ZIP Code <input id="zip" name="zip" type="text"></p>
      <div style="margin:0 0 0 210px">
        <input value="Show Results" onclick="checkSearch()" id="btnSearch" class="button" type="button">
        <input type="reset" class="button" value="Reset Form" onclick="">
      </div>
    </fieldset>
  </form>
  <div id="tableOutput"></div>
  <div id="dump"></div>
  <table id="output"></table>
</body>
</html>